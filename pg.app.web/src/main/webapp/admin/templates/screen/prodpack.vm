<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<link href="/css/comboxList.css" rel="stylesheet">
<link href="/css/numberInput.css" rel="stylesheet">
<table>
	<tr>
		<td class="comboList">
			<h2>可添加的商品
				<span class="selectAll"><i class="icon-check"></i>全选</span>
				<input type="text" placeholder="可输入名称/编号来过滤" class="filter">
			</h2>
			<div id="box1" class="box">
			#foreach($exclude in $excludeList)
			<div class="item">
				<label>[$exclude.code]</label><label>$exclude.name</label>
				<input class="prod" type="hidden" value="${exclude.id}"/>
				数量:
				<span class="numbericLeft"><i class="icon-plus-mini"></i></span>
					<input type="text" class="quan" value="1" style="text-align: center;width: 30px;border-left: 0px;border-right: 0px;">
				<span class="numbericRight"><i class="icon-minus-mini"></i></span>
				单位:&nbsp;&nbsp;<input type="text" class="unit" value="" style="text-align: center;width: 30px;">
			</div>
			#end
			</div>
		</td>
		<td>
			&nbsp;<a class="linkBtn" id="btnDel">&lt;</a> <a class="linkBtn" id="btnAdd">&gt;</a>&nbsp;
		</td>
		<td class="comboList">
			<h2>已添加的商品
				<span class="selectAll"><i class="icon-check"></i>全选</span>
				<input type="text" placeholder="可输入名称/编号来过滤" class="filter">
			</h2>
			<div id="box2" class="box">
			#foreach($include in $includeList)
			<div class="item">
				<label>[$include.code]</label><label>$include.name</label>
				<input class="prod" type="hidden" value="${include.productId}"/>
				数量:
				<span class="numbericLeft"><i class="icon-plus-mini"></i></span>
					<input type="text" class="quan" disabled value="${include.quantity}" style="text-align: center;width: 30px;border-left: 0px;border-right: 0px;">
				<span class="numbericRight"><i class="icon-minus-mini"></i></span>
				单位:&nbsp;&nbsp;<input type="text" disabled class="unit" value="${include.unit}" style="text-align: center;width: 30px;">
			</div>
			#end
			</div>
		</td>
	</tr>
</table>
#set ($group = $form.prodpack.defaultInstance)
<form action="$admin.setTarget('prodpack.vm')?packageId=$!{packageId}" method="post" id="actionFrom">
	$csrfToken.hiddenField
	<input type="hidden" name="action" value="prodpackAction"/>  
	<input type="hidden" id="event" name="event_submit_do_create" value="true"/>
	<input type="hidden" id="packageId" name="$group.packageId.key" value="$!{packageId}"/>
	<input type="hidden" id="productIds" name="$group.productIds.key" value=""/>
	<input type="hidden" id="quantitys" name="$group.quantitys.key" value=""/>
	<input type="hidden" id="units" name="$group.units.key" value=""/>
</form>
<script type="text/javascript" src="/js/comboxList.js"></script>
<script type="text/javascript" src="/js/numberInput.js"></script>
<script type="text/javascript">
    jQuery(function(){
    	jQuery("#btnAdd").click(function(){
    		if(!checkAddValid()){
    			alert("数量必填且为数字,单位必填!");
    			return;
    		}
    		
    		var productIds = "";
    		var quantitys = "";
    		var units = "";
        	jQuery("#box1 .selected").each(function(){
        		productIds += jQuery(this).find(".prod").val()+",";
        		quantitys += jQuery(this).find(".quan").val()+",";
        		units += jQuery(this).find(".unit").val()+",";
        	});
        	var event = "event_submit_do_update";
        	jQuery("#productIds").val(productIds);
        	jQuery("#quantitys").val(quantitys);
        	jQuery("#units").val(units);
        	jQuery("#event").attr("name",event);
        	jQuery("#actionFrom").submit();
    	});
    	
    	jQuery("#btnDel").click(function(){
    		if(!checkDelValid()){
    			alert("数量必填且为数字,单位必填!");
    			return;
    		}
    		
    		var productIds = "";
    		var quantitys = "";
    		var units = "";
        	jQuery("#box2 .selected").each(function(){
        		productIds += jQuery(this).find(".prod").val()+",";
        		quantitys += jQuery(this).find(".quan").val()+",";
        		units += jQuery(this).find(".unit").val()+",";
        	});
        	var event = "event_submit_do_delete";
        	jQuery("#productIds").val(productIds);
        	jQuery("#quantitys").val(quantitys);
        	jQuery("#units").val(units);
        	jQuery("#event").attr("name",event);
        	jQuery("#actionFrom").submit();
    	});
    	
    	function checkAddValid(){
    		var valid = true;
    		jQuery("#box1 .selected").each(function(){
        		var quan = jQuery(this).find(".quan").val();
        		if(!quan.isNumber()){
        			valid = false;
        		}
        		var unit = jQuery(this).find(".unit").val();
        		if(unit == ""){
        			valid = false;
        		}
        	});
    		return valid;
    	}
    	
    	function checkDelValid(){
    		var valid = true;
    		jQuery("#box2 .selected").each(function(){
        		var quan = jQuery(this).find(".quan").val();
        		if(!quan.isNumber()){
        			valid = false;
        		}
        		var unit = jQuery(this).find(".unit").val();
        		if(unit == ""){
        			valid = false;
        		}
        	});
    		return valid;
    	}
    	
    	jQuery(".quan").change(function(){
    		if(!jQuery(this).parent().hasClass("selected")){
    			jQuery(this).addClass("selected");
    		}
    	});
    	
    	jQuery(".unit").change(function(){
    		if(!jQuery(this).parent().hasClass("selected")){
    			jQuery(this).addClass("selected");
    		}
    	});
    });
</script>
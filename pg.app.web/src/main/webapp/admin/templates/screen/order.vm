<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<div class="doc-content">
	<form action="$admin.setTarget('order.vm')" class="form-horizontal well" id="queryForm">
		<div class="row">
			<div class="control-group">
				<label class="control-label">客户姓名：</label>
				<div class="controls">
					<input type="text" class="control-text" name="customerName" value="$!query.customerName">
				</div>
				<label class="control-label">发货地址：</label>
				<div class="controls">
					<input type="text" class="control-text" name="addressFrom" value="$!query.addressFrom">
					<input type="hidden" name="page" id="page" value="$query.page">
					<input type="hidden" name="customerId" value="$query.customerId">
				</div>
				<label class="control-label">收货地址：</label>
				<div class="controls">
					<input type="text" class="control-text" name="addressTo" value="$!query.addressTo">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="control-group">
				<label class="control-label">联系人：</label>
				<div class="controls">
					<input type="text" class="control-text" name="keeper" value="$!query.keeper">
				</div>
				<label class="control-label">联系人手机：</label>
				<div class="controls">
					<input type="text" class="control-text" name="mobile" value="$!query.mobile">
				</div>
				<label class="control-label">联系人电话：</label>
				<div class="controls">
					<input type="text" class="control-text" name="phone" value="$!query.phone">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="control-group">
				<label class="control-label">状态：</label>
				<div class="controls">
					<select name="status">
					<option selected value="">全部</option>
					#foreach($status in $statusEnum)
					<option 
						#if($!query.status)
							#if($!query.status==$!status.code)
								selected
							#end
						#end 
						value="$!status.code">$!status.desc</option>
					#end
				</select>
				</div>
				<label class="control-label">物流编号：</label>
				<div class="controls">
					<input type="text" class="control-text" name="transportCode" value="$!query.transportCode">
				</div>
				<label class="control-label">交易日期：</label>
				<div class="controls">
					<input type="text" class="calendar" name="createStart" id="createStart" value="$!query.createStart">
					至
					<input type="text" class="calendar" name="createEnd" id="createEnd" value="$!query.createEnd">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="form-actions offset3">
				<button class="button button-primary"><i class="icon-search icon-white"></i>搜索</button>
				<button type="reset" class="button"><i class="icon-repeat"></i>重置</button>
			</div>
		</div>
	</form>
	<script type="text/javascript">
		var Calendar = BUI.Calendar;
		
		var createStart = new Calendar.DatePicker({
		  trigger:'#createStart',
		  selectedDate : new Date(),
		  autoRender : true
		});
		
		var createEnd = new Calendar.DatePicker({
			  trigger:'#createEnd',
			  selectedDate : new Date(),
			  autoRender : true
		});
	</script>
</div>
<div id="grid"></div>
$control.setTemplate("paging.vm")
<script type="text/javascript">
      var Grid = BUI.Grid,
      Data = BUI.Data;
      var Grid = Grid,
      Store = Data.Store,
      statusObj = {
   	   		#foreach($status in $statusEnum)
   			"$!status.key": "$!status.value"
   				#if(${velocityCount} != $statusEnum.size())
   					,
   				#end
   			#end
   	  },
      columns = [
		{
			title : 'ID',
			elCls: 'center',
			dataIndex : 'id',
			width:'5%'
		},{
			title : '客户名称',
			elCls: 'left',
			dataIndex : 'customerName',
			width:'10%'
		},{
            title : '交易时间',
            elCls: 'left',
            dataIndex :'gmtCreate',
            renderer:BUI.Grid.Format.datetimeRenderer,
            summary : false,
            width:'10%'
        },{
            title : '定金',
            elCls: 'left',
            dataIndex :'deposite',
            editor : {
				xtype : 'number',
				rules : {required : true}
		  	},
            summary : true,
		    width:'10%'
        },{
        	title : '交易金额',
            elCls: 'left',
            dataIndex :'totalPrice',
            editor : {
				xtype : 'number',
				rules : {required : true}
		  	},
            summary : true,
		    width:'10%'
        },{
        	title : '物流费',
            elCls: 'left',
            dataIndex :'transportFee',
            editor : {
				xtype : 'number',
				rules : {required : true}
		  	},
            summary : true,
		    width:'10%'
        },{
            title : '物流编号',
            elCls: 'left',
            dataIndex :'transportCode',
            editor : {
				xtype : 'text',
				rules : {required : true}
		  	},
            summary : true,
            width:'10%'
        },{
            title : '状态',
            elCls: 'left',
            dataIndex :'status',
            editor : {
  				xtype : 'select',
  				items : statusObj,
  				rules : {required : true}
  		  	},
            renderer : Grid.Format.enumRenderer(statusObj),
            summary : false,
            width:'10%'
        },{
            title : '总价',
            elCls: 'left',
            dataIndex :'total',
            renderer: function(val,obj,index){
            	if(obj!=null){
            		var result = 0;
            		var totalPrice = obj.totalPrice;
            		var transportFee = obj.transportFee;
            		if(totalPrice != null && totalPrice.isNumber()){
            			result += totalPrice;
            		}
            		if(transportFee != null && transportFee.isNumber()){
            			result += transportFee;
            		}
            		return result;
            	}
            	return 0;
            }, 
            summary : true,
            width:'10%'
        },{
			title : '操作',
			elCls: 'center',
			dataIndex : 'oper',
			renderer : function(val,obj,index) {
				var detail = "";
				if(obj != null){
					var id = obj.id;
					detail = '<span class="grid-command"><a href="$admin.setTarget("orderdetail.vm")?id='+id+'">详情</a></span>';
				}
				var edit = '<span class="grid-command btn-edit">编辑</span>';
				return detail+edit;
			},
			width:'15%'
		}],
		data = #if($!{list})#noescape()$!{list}#end#else null #end;
      var store = new Store({
        data : data,
        listeners : {
        	'update' : updateFunction
        }
      }),
      cascade = new Grid.Plugins.Cascade({
		    renderer : function(record){
			    var row = '<div><p>&nbsp;发货地址：' + record.addressFrom + '</p></div>';
			    row += '<div><p>&nbsp;收货地址：' + record.addressTo + '</p></div>';
			    row += '<div><p>&nbsp;联系人：' + record.keeper + ' ' + record.mobile + ' ' + record.phone + '</p></div>';
			    row += '<div><p>&nbsp;备注：' + record.comment + '</p></div>';
			    return row;
		    }
	  }),
      editing = new Grid.Plugins.RowEditing({
			triggerCls : 'btn-edit',
			triggerSelected : false
	  }),
      grid = new Grid.Grid({
        render:'#grid',
        width:'100%',//这个属性一定要设置
        columns : columns,
        bbar : {
        	items : [
			{
				btnCls : 'button button-small btn-add',
				text : '<i class="icon-plus"></i>添加',
				listeners : {
					'click' : addFunction
				}
			}
			]
        },
        plugins : [cascade,editing,Grid.Plugins.Summary],
        store : store
      });

    grid.render();
    
    function addFunction(){
	}
    
    function updateFunction(e){
    }
</script>